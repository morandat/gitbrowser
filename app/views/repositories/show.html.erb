<div id="global">

  <div id="revisions">
    <div>
      <div>
        <div class="repository_name bg-primary">
          <%= @repository.name %>
        </div>
        <div class="btn-group btn-group-justified" role="toolbar"
             style="padding: 5px" aria-label="comment_buttons">
          <div class="btn-group" role="group">
            <button id="home_button"  type="button" class="btn btn-success">
              Home</button>
          </div>
          <div class="btn-group" role="group">
            <button id="head_button"    type="button" class="btn btn-danger">
              Head</button>
          </div>
          <div class="btn-group" role="group">
            <button id="edit_button" type="button" class="btn btn-primary">
              Edit</button>
          </div>
          <div class="btn-group" role="group">
            <button id="index_button" type="button" class="btn btn-primary">
              Index</button>
          </div>
        </div>
      </div>

      <input type="hidden" id="repository_id"
             value="<%= @repository.id %>"/>
      <input type="hidden" id="revision"
             value="<%= @selected_revision[:sha] %>"/>
      <input type="hidden" id="filename"
             value="<%= @selected_file %>"/>
    </div>

    <div>
      <select id="revision_selector" onChange="fetch_file_list(base_viewer)">
        <% @revisions.each_with_index do |r| %>
        <option value="<%= r[:sha] %>"
                <% if r[:sha] == @selected_revision[:sha] %>
                selected="selected"
                <% end %>
                >
          <%= r[:sha][0..6] %> - <%= r[:date] %> - <%= r[:author] %>
        </option>
        <% end %>
      </select>
    </div>

    <div id="file_tree">
      <ul id="file_tree_revisions">
      </ul>
    </div>
  </div>

  <div id="home">
    <div id="all_comments_div"></div>
  </div>

  <div id="viewer">
    <div class="viewer_header"><%= @selected_file %></div>
    <div id="viewer_div" class="viewer_container"></div>
  </div>

  <div id="overlays"></div>

  <div id="comments">
    <div class="btn-group btn-group-justified" role="toolbar"
         style="padding: 5px" aria-label="comment_buttons">
      <div class="btn-group" role="group">
        <button id="warning_button"  type="button" class="btn btn-warning">
          Warning</button>
      </div>
      <div class="btn-group" role="group">
        <button id="error_button"    type="button" class="btn btn-danger">
          Error</button>
      </div>
      <div class="btn-group" role="group">
        <button id="toggle_comments" type="button" class="btn btn-primary">
          Toggle</button>
      </div>
    </div>

    <p></p>

    <div id="current_comments">
      <div id="current_comments_hd" class="comments_head">Current comments</div>
      <div id="current_comments_div"></div>
    </div>

    <div id="other_comments">
      <div id="other_comments_hd" class="comments_head">Comments for another revision</div>
      <div id="other_comments_div"></div>
    </div>

    <div id="ancient_comments">
      <div id="ancient_comments_hd" class="comments_head">Ancient comments</div>
      <div id="ancient_comments_div"></div>
    </div>

  </div>

  <div id="side_comments">
    <button id="closediff_button">Close Diff</button>

    <p></p>

    Current comment&nbsp;:
    <div id="old_side_comment_div"></div>

    Modified comment&nbsp;:
    <div id="new_side_comment_div"></div>
  </div>

  <div id="side_viewer">
    <div class="viewer_header"></div>
    <div id="side_viewer_div" class="viewer_container">
  </div>

</div>

<script>
  var base_viewer = ace.edit("viewer_div");
  var comments = {}; // Dict to centralize the comments
  base_viewer.setReadOnly(true);
  init_file_tree(base_viewer);

  <% if @selected_revision %>
    fetch_file_list(base_viewer, "<%= @selected_revision[:sha] %>");
  <% end %>

  $("#head_button").click(() => load_head_revision(base_viewer));
  $("#home_button").click(() => load_empty_file(base_viewer));
  $("#edit_button").click(() =>
     window.location.href = "<%= edit_repository_path(@repository) %>");
  $("#index_button").click(() =>
     window.location.href = "<%= repositories_path %>");
  $("#warning_button").click(save_new_comment("warning", base_viewer));
  $("#error_button").click(save_new_comment("error", base_viewer));
  $("#closediff_button").click(() => close_diff_view(base_viewer));
  $("#toggle_comments").click(toggle_comments);
</script>
